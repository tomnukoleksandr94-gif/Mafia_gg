<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>COSMIC MAFIA ONLINE</title>
    <style>
        /* === –¢–í–Ü–ô –î–ò–ó–ê–ô–ù (NEON STYLE) === */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;900&display=swap');

        :root {
            --bg: #050010;
            --neon-blue: #00f3ff;
            --neon-red: #ff2d55;
            --neon-gold: #ffcc00;
            --glass: rgba(255, 255, 255, 0.05);
        }

        body {
            background: var(--bg);
            color: white;
            font-family: 'Orbitron', sans-serif;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* –ï–ö–†–ê–ù–ò (–°–¶–ï–ù–ò) */
        .screen {
            display: none; /* –•–æ–≤–∞—î–º–æ –≤—Å—ñ –µ–∫—Ä–∞–Ω–∏ */
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at center, #1a0b2e 0%, #000 100%);
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: flex; /* –ü–æ–∫–∞–∑—É—î–º–æ –∞–∫—Ç–∏–≤–Ω–∏–π */
        }

        /* –ï–õ–ï–ú–ï–ù–¢–ò –Ü–ù–¢–ï–†–§–ï–ô–°–£ */
        h1 { text-shadow: 0 0 15px var(--neon-blue); margin-bottom: 20px; text-align: center; }
        
        .btn {
            background: var(--glass);
            border: 1px solid var(--neon-blue);
            color: var(--neon-blue);
            padding: 15px 40px;
            font-size: 18px;
            margin: 10px;
            cursor: pointer;
            text-transform: uppercase;
            box-shadow: 0 0 10px var(--neon-blue);
            transition: 0.3s;
            width: 80%;
            max-width: 300px;
        }

        .btn:active { transform: scale(0.95); background: var(--neon-blue); color: #000; }
        .btn-red { border-color: var(--neon-red); color: var(--neon-red); box-shadow: 0 0 10px var(--neon-red); }
        .btn-gold { border-color: var(--neon-gold); color: var(--neon-gold); box-shadow: 0 0 10px var(--neon-gold); }

        /* –Ü–ù–§–û–†–ú–ê–¶–Ü–Ø –ü–†–û –ì–†–ê–í–¶–Ø */
        .profile-bar {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 12px;
            color: #aaa;
            z-index: 100;
        }

        /* –ê–ù–Ü–ú–ê–¶–Ü–Ø –ü–û–®–£–ö–£ */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--neon-blue);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* –Ü–ì–†–û–í–ï –ü–û–õ–ï (–°–ø—Ä–æ—â–µ–Ω–æ –¥–ª—è —Ç–µ—Å—Ç—É) */
        .game-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 90%;
        }
        .player-card {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border: 1px solid #fff;
            text-align: center;
        }
        .my-role {
            font-size: 24px;
            color: var(--neon-gold);
            margin: 20px;
            text-shadow: 0 0 20px var(--neon-gold);
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
    
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>

    <div class="profile-bar">
        ID: <span id="my-id">...</span> | üí∞ <span id="my-coins">0</span>
    </div>

    <div id="screen-menu" class="screen active">
        <h1>COSMIC MAFIA</h1>
        <button class="btn" onclick="findGame('mafia')">–ì–†–ê–¢–ò –í –ú–ê–§–Ü–Æ</button>
        <button class="btn btn-gold" onclick="findGame('roulette')">–†–£–õ–ï–¢–ö–ê (100üí∞)</button>
        <button class="btn btn-red">–ú–ê–ì–ê–ó–ò–ù</button>
    </div>

    <div id="screen-search" class="screen">
        <div class="loader"></div>
        <h2>–ü–û–®–£–ö –ì–†–ê–í–¶–Ü–í...</h2>
        <p id="queue-status">0 / 4</p>
        <button class="btn btn-red" onclick="location.reload()">–°–ö–ê–°–£–í–ê–¢–ò</button>
    </div>

    <div id="screen-game" class="screen">
        <div class="my-role" id="role-display">ROLE: ???</div>
        <h3 id="game-status">–û–ß–Ü–ö–£–í–ê–ù–ù–Ø –•–û–î–£...</h3>
        
        <div class="game-grid" id="players-container"></div>
    </div>

    <script>
        // === –õ–û–ì–Ü–ö–ê –ö–õ–Ü–Ñ–ù–¢–ê ===
        
        // 1. –ó'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å —Ç–≤—ñ–π —Å–µ—Ä–≤–µ—Ä)
        const socket = io();

        // –ï–º—É–ª—è—Ü—ñ—è Telegram ID (—â–æ–± –º–æ–∂–Ω–∞ –±—É–ª–æ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ)
        // –í —Ä–µ–∞–ª—å–Ω–æ–º—É Telegram —Ü–µ –±—É–¥–µ: window.Telegram.WebApp.initDataUnsafe.user.id
        const myTgId = Math.floor(Math.random() * 1000000); 
        const myName = "Player_" + Math.floor(Math.random() * 100);

        // –ï–ª–µ–º–µ–Ω—Ç–∏
        const screens = {
            menu: document.getElementById('screen-menu'),
            search: document.getElementById('screen-search'),
            game: document.getElementById('screen-game')
        };

        // –§—É–Ω–∫—Ü—ñ—è –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –µ–∫—Ä–∞–Ω—ñ–≤
        function showScreen(name) {
            Object.values(screens).forEach(s => s.classList.remove('active'));
            screens[name].classList.add('active');
        }

        // --- –ü–û–î–Ü–á –°–ï–†–í–ï–†–ê ---

        socket.on('connect', () => {
            console.log("üü¢ –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ —Å–µ—Ä–≤–µ—Ä–∞!");
            // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è
            socket.emit('auth', { tgId: myTgId, username: myName });
        });

        socket.on('auth_success', (data) => {
            document.getElementById('my-id').innerText = myName;
            document.getElementById('my-coins').innerText = data.coins;
        });

        socket.on('queue_update', (data) => {
            document.getElementById('queue-status').innerText = `${data.count} / ${data.max}`;
        });

        socket.on('game_start', (data) => {
            showScreen('game');
            renderPlayers(data.players);
        });

        socket.on('roulette_start', (data) => {
            showScreen('game');
            document.getElementById('role-display').innerText = "üî´ –†–£–õ–ï–¢–ö–ê";
            renderPlayers(data.players);
        });

        socket.on('your_role', (role) => {
            document.getElementById('role-display').innerText = role;
            if(role === 'MAFIA') document.getElementById('role-display').style.color = 'red';
            if(role === 'SHERIFF') document.getElementById('role-display').style.color = 'blue';
        });

        socket.on('phase_change', (data) => {
            document.getElementById('game-status').innerText = data.msg;
            // –¢—É—Ç –¥–æ–¥–∞–º–æ –∞–Ω—ñ–º–∞—Ü—ñ—é –∑–º—ñ–Ω–∏ –¥–Ω—è/–Ω–æ—á—ñ
            if(data.phase === 'NIGHT') document.body.style.background = '#000';
            else document.body.style.background = 'radial-gradient(circle at center, #1a0b2e 0%, #000 100%)';
        });

        socket.on('error', (msg) => {
            alert("–ü–û–ú–ò–õ–ö–ê: " + msg);
            location.reload();
        });

        // --- –î–Ü–á –ì–†–ê–í–¶–Ø ---

        function findGame(type) {
            showScreen('search');
            socket.emit('find_game', type);
        }

        function renderPlayers(players) {
            const container = document.getElementById('players-container');
            container.innerHTML = '';
            
            players.forEach(p => {
                const div = document.createElement('div');
                div.className = 'player-card';
                div.innerHTML = `
                    <div style="font-size:30px">üë§</div>
                    <div>${p.name}</div>
                `;
                
                // –ö–ª—ñ–∫ –ø–æ –≥—Ä–∞–≤—Ü—é (–≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è / –ø–æ—Å—Ç—Ä—ñ–ª)
                div.onclick = () => {
                    if(p.id === socket.id) return; // –ù–µ –º–æ–∂–Ω–∞ —Å—Ç—Ä—ñ–ª—è—Ç–∏ –≤ —Å–µ–±–µ (–ø–æ–∫–∏ —â–æ)
                    socket.emit('game_action', { targetId: p.id, action: 'interact' });
                    div.style.borderColor = 'red'; // –ü—ñ–¥—Å–≤—ñ—Ç–∫–∞ –≤–∏–±–æ—Ä—É
                };
                
                container.appendChild(div);
            });
        }
    </script>
</body>
</html>
